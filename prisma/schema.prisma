generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Escort {
  id             String       @id @unique @db.Char(12) // ESC-XXXXXXXX
  user_id        String
  destination_id String       @db.Char(12)
  status         EscortStatus @default(ONPROGRESS)
  expired_at     BigInt
  created_at     BigInt
  completed_at   BigInt?
  cancelled_at   BigInt?

  service_experience ServiceExperience?

  destination TireRepairShop @relation(fields: [destination_id], references: [id], onDelete: Restrict)

  @@map("escorts")
}

model ServiceExperience {
  id           String  @id @db.Char(8)
  escort_id    String  @unique @db.Char(12)
  is_anonymous Boolean @default(false)
  rating       Int?    @db.SmallInt
  review       String? @db.VarChar(1000)
  rated_at     BigInt?
  reviewed_at  BigInt?

  escort Escort @relation(fields: [escort_id], references: [id], onDelete: Restrict)

  @@map("service_experiences")
}

model TireRepairShop {
  id         String  @id @db.Char(12) // TRS-XXXXXXXX
  owner_id   String  @unique
  name       String  @db.VarChar(50)
  rating     Decimal @db.Decimal(2, 1)
  latitude   Float
  longitude  Float
  created_at BigInt

  visits Escort[]

  @@map("tire_repair_shops")
}

enum EscortStatus {
  COMPLETED
  ONPROGRESS
  CANCELLED
}
